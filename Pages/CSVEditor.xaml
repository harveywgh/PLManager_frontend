<Page x:Class="PL_Manager.Pages.CSVEditorPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      Title="Éditeur de CSV">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- 📦 Zone principale contenant l’en-tête et le tableau -->
        <Border CornerRadius="2" Background="white" Margin="10" Grid.Row="0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <ScrollViewer x:Name="MainScrollViewer"
                              VerticalScrollBarVisibility="Visible"
                              HorizontalScrollBarVisibility="Auto"
                              Margin="0"
                              ClipToBounds="False">
                    <ScrollViewer.Resources>
                        <Style TargetType="ScrollBar" BasedOn="{StaticResource CustomVerticalScrollBarStyle}">
                            <Style.Triggers>
                                <Trigger Property="Orientation" Value="Vertical"/>
                            </Style.Triggers>
                        </Style>
                    </ScrollViewer.Resources>

                    <!-- ✅ GRID contenant la colonne de numérotation + tableau -->
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="40"/>
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <!-- 📎 Numéros de ligne (1, 2, 3...) -->
                        <StackPanel x:Name="ExcelRowNumbers"
                                    Grid.Column="0"
                                    Background="LightGray"
                                    VerticalAlignment="Top"
                                    HorizontalAlignment="Stretch" />

                        <!-- 📊 En-têtes A, B, C + DataGrid -->
                        <StackPanel Grid.Column="1"
                                    Orientation="Vertical">
                            <!-- 🔤 En-têtes colonnes -->
                            <UniformGrid x:Name="ExcelHeaderGrid"
                                         Rows="1"
                                         Background="LightGray"/>

                            <!-- 📋 Tableau -->
                            <DataGrid x:Name="CsvDataGrid"
                                      AutoGenerateColumns="True"
                                      CanUserAddRows="False"
                                      CanUserDeleteRows="False"
                                      IsReadOnly="False"
                                      HeadersVisibility="Column"
                                      FrozenColumnCount="1"
                                      AlternatingRowBackground="white"
                                      Background="white"
                                      GridLinesVisibility="All"
                                      MinColumnWidth="100"
                                      SelectionUnit="Cell"
                                      SelectionMode="Extended"
                                      CellEditEnding="CsvDataGrid_CellEditEnding"
                                      BeginningEdit="CsvDataGrid_BeginningEdit"
                                      PreviewKeyDown="CsvDataGrid_PreviewKeyDown">
                                <DataGrid.Resources>
                                    <!-- 🔘 Colonnes -->
                                    <Style TargetType="DataGridColumnHeader">
                                        <Setter Property="Background" Value="#ffffff"/>
                                        <Setter Property="BorderBrush" Value="black"/>
                                        <Setter Property="BorderThickness" Value="1"/>
                                        <Setter Property="FontWeight" Value="Bold"/>
                                        <Setter Property="HorizontalContentAlignment" Value="Center"/>
                                    </Style>
                                    <!-- 🧩 Cellules -->
                                    <Style TargetType="DataGridCell">
                                        <Setter Property="Background" Value="Transparent"/>
                                        <Setter Property="BorderBrush" Value="white"/>
                                        <Setter Property="BorderThickness" Value="0"/>
                                        <Setter Property="Padding" Value="5"/>
                                        <Setter Property="Focusable" Value="True"/>
                                        <Setter Property="IsTabStop" Value="True"/>
                                        <Style.Triggers>
                                            <Trigger Property="IsSelected" Value="True">
                                                <Setter Property="Background" Value="Transparent"/>
                                                <Setter Property="BorderBrush" Value="{DynamicResource PrimaryBlueColor}"/>
                                                <Setter Property="BorderThickness" Value="1.5"/>
                                                <Setter Property="Foreground" Value="Black"/>
                                            </Trigger>
                                        </Style.Triggers>
                                    </Style>
                                    <!-- 🧮 RowHeader -->
                                    <Style TargetType="DataGridRowHeader">
                                        <Setter Property="HorizontalContentAlignment" Value="Center"/>
                                        <Setter Property="Foreground" Value="Black"/>
                                        <Setter Property="BorderBrush" Value="Black"/>
                                        <Setter Property="BorderThickness" Value="1"/>
                                        <Setter Property="IsHitTestVisible" Value="False"/>
                                    </Style>
                                </DataGrid.Resources>
                            </DataGrid>
                        </StackPanel>
                    </Grid>
                </ScrollViewer>

                <!-- 🔁 Slider horizontal -->
                <Grid Grid.Row="1" Margin="10,5,10,0" Height="30">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <Slider x:Name="HorizontalSlider"
                            Grid.Column="1"
                            Style="{StaticResource HorizontalSliderStyle}"
                            Minimum="0"
                            Maximum="100"
                            Value="0"
                            Height="24"
                            TickFrequency="1"
                            SmallChange="1"
                            LargeChange="5"
                            ValueChanged="HorizontalSlider_ValueChanged"
                            HorizontalAlignment="Stretch"
                            Margin="10,0"/>
                </Grid>
            </Grid>
        </Border>

        <!-- 🔘 Sélection fichiers -->
        <StackPanel x:Name="FileButtonPanel"
                    Orientation="Horizontal"
                    HorizontalAlignment="Center"
                    Margin="10"
                    Grid.Row="1" />

        <!-- 💾 Enregistrer -->
        <Button Content="Enregistrer"
                Click="SaveCsv_Click"
                Style="{StaticResource SquareButtonStyle}"
                Width="200"
                Height="40"
                FontSize="14"
                FontWeight="SemiBold"
                Margin="10"
                Grid.Row="2"
                HorizontalAlignment="Right"
                VerticalAlignment="Bottom"/>
    </Grid>
</Page>
